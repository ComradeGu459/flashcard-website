<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>科学闪卡记忆系统</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: "微软雅黑", Arial, sans-serif; background: #f6f8fa; margin: 0; }
    .container { max-width: 900px; margin: 30px auto; background: #fff; border-radius: 18px; box-shadow: 0 4px 24px #0002; padding: 30px; }
    h2 { margin: 8px 0 18px 0; }
    .sidebar { float:left; width:170px; margin-right:25px; }
    .sidebar .subject { font-weight: bold; margin: 8px 0 4px 0; }
    .sidebar .chapter { cursor:pointer; padding:3px 10px; border-radius:7px; margin-bottom:2px; display:block; color:#333;}
    .sidebar .chapter.active { background: #3b82f6; color: #fff; }
    .main { margin-left:200px; }
    .flashcard { width:340px; height:190px; margin:40px auto 16px auto; perspective:900px; }
    .card-inner { width:100%; height:100%; position:relative; transition:transform 0.5s; transform-style:preserve-3d; }
    .flipped .card-inner { transform: rotateY(180deg);}
    .card-face { position:absolute; width:100%; height:100%; backface-visibility:hidden; border-radius:18px; box-shadow:0 3px 18px #0002; background:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:1.2rem;}
    .card-face.back { transform:rotateY(180deg); background: #f0f9f1; color: #15803d;}
    .tags { margin-top:10px;}
    .tag { background:#fde68a; color:#92400e; font-size:0.8rem; padding:2px 8px; border-radius:8px; margin-right:4px;}
    .review-btns button { margin:0 8px; padding:6px 14px; border-radius:7px; border:none; font-weight:500; cursor:pointer;}
    .review-btns .hard { background:#fecaca; color:#b91c1c;}
    .review-btns .medium { background:#fef08a; color:#a16207;}
    .review-btns .easy { background:#bbf7d0; color:#166534;}
    .panel { margin-bottom: 18px; background: #f1f5f9; border-radius: 10px; padding: 12px 20px; display: flex; gap:24px;}
    .panel .block { text-align:center;}
    .panel .num { font-weight:bold; font-size:1.2rem;}
    .import-box { margin:16px 0;}
    .import-box textarea { width:100%; height:60px;}
    .import-box button { margin-top:6px;}
    @media(max-width:750px){
      .sidebar{float:none; width:100%; margin:0 0 16px 0;}
      .main{margin:0;}
      .flashcard{width:96vw;}
      .container{padding:8vw;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>科学闪卡记忆系统</h2>
    <div class="panel">
      <div class="block"><div class="num" id="stat-learned">0</div><div>已掌握</div></div>
      <div class="block"><div class="num" id="stat-reviewing">0</div><div>复习中</div></div>
      <div class="block"><div class="num" id="stat-unlearned">0</div><div>未学习</div></div>
      <div class="block"><div class="num" id="stat-total">0</div><div>总卡片</div></div>
    </div>
    <div class="import-box">
      <strong>批量导入（JSON数组，每条需含subject、chapter、front、back，可选tags）：</strong><br>
      <textarea id="import-input" placeholder='[{"subject":"数学","chapter":"微积分","front":"导数定义","back":"lim(h→0)[f(x+h)-f(x)]/h"}]'></textarea><br>
      <button onclick="importData()">导入</button>
      <span style="color:#4b5563;font-size:0.95em">导入内容自动追加，数据存于浏览器本地</span>
    </div>
    <div class="sidebar" id="sidebar"></div>
    <div class="main">
      <div id="flashcard-box"></div>
      <div id="review-btns" class="review-btns" style="text-align:center;"></div>
    </div>
    <div style="clear:both;"></div>
  </div>
<script>
let flashcards = JSON.parse(localStorage.getItem("flashcards")||"[]");
let subject = flashcards[0]?.subject || "";
let chapter = flashcards[0]?.chapter || "";
let idx = 0, flipped = false;

function saveCards(){ localStorage.setItem("flashcards",JSON.stringify(flashcards)); }
function groupBySubject(cards){
  let map={}; cards.forEach(c=>{
    if(!map[c.subject]) map[c.subject]=new Set();
    map[c.subject].add(c.chapter);
  }); return map;
}
function renderSidebar(){
  let map = groupBySubject(flashcards);
  let html = ""; 
  Object.keys(map).forEach(s=>{
    html += `<div class="subject">${s}</div>`;
    Array.from(map[s]).forEach(c=>{
      html += `<div class="chapter${subject===s&&chapter===c?' active':''}" onclick="setChapter('${s}','${c}')">${c}</div>`;
    });
  });
  document.getElementById("sidebar").innerHTML = html;
}
function setChapter(s, c){
  subject=s; chapter=c; idx=0; flipped=false; renderAll();
}
function renderFlashcard(){
  let cards = flashcards.filter(x=>x.subject===subject&&x.chapter===chapter);
  if(!cards.length){ document.getElementById("flashcard-box").innerHTML = "<div style='color:#aaa'>该章节暂无卡片</div>"; document.getElementById("review-btns").innerHTML="";return;}
  idx = Math.min(idx, cards.length-1);
  let card = cards[idx];
  let tagHtml = (card.tags||"").split(",").filter(Boolean).map(t=>`<span class="tag">${t}</span>`).join("");
  document.getElementById("flashcard-box").innerHTML = `
    <div class="flashcard${flipped?' flipped':''}" onclick="flipCard()">
      <div class="card-inner">
        <div class="card-face front">
          <div style="font-size:0.96rem;color:#64748b">${card.subject} / ${card.chapter}</div>
          <div style="font-weight:bold; font-size:1.22rem;margin:10px 0;">${card.front}</div>
          <div class="tags">${tagHtml}</div>
        </div>
        <div class="card-face back">
          <div style="font-weight:600; font-size:1.2rem;">${card.back}</div>
        </div>
      </div>
    </div>
    <div style="text-align:center;font-size:0.97rem; margin-top:10px;color:#64748b">
      第 ${idx+1} / ${cards.length} 张
      <button onclick="prevCard();event.stopPropagation();" style="margin-left:12px;">上一张</button>
      <button onclick="nextCard();event.stopPropagation();" style="margin-left:8px;">下一张</button>
    </div>
  `;
  document.getElementById("review-btns").innerHTML = flipped?`
    <button class="hard" onclick="reviewCard('hard')">困难</button>
    <button class="medium" onclick="reviewCard('medium')">模糊</button>
    <button class="easy" onclick="reviewCard('easy')">清晰</button>
  `:"";
}
function flipCard(){flipped=!flipped;renderFlashcard();}
function nextCard(){idx++;flipped=false;renderFlashcard();}
function prevCard(){idx=idx>0?idx-1:0;flipped=false;renderFlashcard();}
function reviewCard(level){
  let cards = flashcards.filter(x=>x.subject===subject&&x.chapter===chapter);
  let card = cards[idx];
  let base = {hard:1,medium:3,easy:7}[level], old=card.interval||1;
  let interval = level==='hard'?1:level==='medium'?Math.max(3,old*1.5):Math.max(7,old*2);
  card.lastReviewed=Date.now(); card.interval=interval; card.nextReview=Date.now()+interval*86400000;
  card.reviewCount=(card.reviewCount||0)+1;
  saveCards();
  nextCard();
}
function renderStats(){
  let learned=0,reviewing=0,unlearned=0,total=flashcards.length;
  flashcards.forEach(c=>{
    if((c.reviewCount||0)>=3) learned++;
    else if(c.reviewCount) reviewing++;
    else unlearned++;
  });
  document.getElementById("stat-learned").textContent=learned;
  document.getElementById("stat-reviewing").textContent=reviewing;
  document.getElementById("stat-unlearned").textContent=unlearned;
  document.getElementById("stat-total").textContent=total;
}
function importData(){
  try{
    let arr = JSON.parse(document.getElementById("import-input").value.trim());
    if(!Array.isArray(arr)) throw "";
    arr.forEach(c=>{
      c.id=Date.now()+Math.random();
      c.reviewCount=0;c.interval=1;c.lastReviewed=0;c.nextReview=0;
    });
    flashcards = flashcards.concat(arr); saveCards(); renderAll();
    alert("导入成功！");
  }catch{ alert("请粘贴正确的JSON数组格式！"); }
}
function renderAll(){
  renderSidebar();
  renderStats();
  renderFlashcard();
}
renderAll();
window.setChapter = setChapter;
window.flipCard = flipCard;
window.nextCard = nextCard;
window.prevCard = prevCard;
window.reviewCard = reviewCard;
window.importData = importData;
</script>
</body>
</html>
